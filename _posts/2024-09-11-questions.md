---
layout: post
title:  "计算机系统的性能建模与设计的难题"
permalink: /queueing/questions/
categories: 计算机系统的性能建模与设计
---
## 计算机系统的性能建模与设计

计算机系统设计充满了难题：

1. 在单台速度为 s 的机器和 n 台速度各为 s/n 的机器之间，应该选择哪一种？
2. 如果到达率和服务率都翻倍，平均响应时间会保持不变吗？
3. 系统是否真的应该旨在平衡负载，还是这只是一个方便的误解？
4. 如果调度策略偏向某些任务，是否一定会损害其他任务，或者这些“守恒定律”被误解了？
5. 在服务器群中，贪婪的、最短延迟的路由策略有意义吗？还是说对个体有利的策略对整个系统反而是灾难性的？
6. 高作业规模的变异性和重尾工作负载如何影响调度策略的选择？
7. 设计计算机系统时，应该如何权衡能耗和延迟？
8. 如果当到达率为9个作业/秒时需要12台服务器来满足延迟保证，那么当到达率为9000个作业/秒时是否需要12,000台服务器？

----

这本书着眼于系统设计者关心的问题，将排队论明确地带回计算机科学领域。书籍的目标读者是计算机科学家和工程师，内容涵盖了来自计算机系统、制造业和运筹学的例子。书籍有趣且易读，非常适合本科生，同时仍保持了严格的学术性，并涵盖了比许多排队论书籍更广泛的主题。

读者将受益于充满动机和直觉的内容，书中有插图、例子和超过300个练习——通过这些内容，读者将掌握建模、分析和设计具有良好性能和低成本的大规模系统的技能。这些练习是重要的特点，它们教授了在计算机系统设计中研究级别的反直觉的经验教训。目标是培养读者不仅能够定制现有的分析方法，还能够发明自己的方法。

-----

Mor Harchol-Balter 是卡内基梅隆大学计算机科学系的副教授。她是 ACM Sigmetrics 会议（关于计算机系统测量和建模的会议）的领导者，曾担任2007年技术项目委员会主席和2013年会议主席。

------
读到这里你肯定对这些问题, 有自己的理解和答案.

我来谈谈我的理解和思考: (**理论和现实的工程实践经常是不一致的**, 读到后面你会发现实际情况和作者设想的假设条件差别极大, 如果不注意假设, 只看结论, 那么结论会完全相反.)

1. **单台速度为 s 的机器 vs. n 台速度为 s/n 的机器**

    GPT说的套话：

    - 这个问题取决于任务的性质。单台速度较快的机器适用于任务依赖性强、难以并行的工作负载，而多台较慢的机器适用于可以并行处理的工作负载。并行系统的效率可能受到通信开销、负载不平衡等问题的影响。因此，答案取决于具体应用环境。

    我的见解：

   - 如果从性能角度出发，我肯定选单台机器，分布式的12台机器还涉及到了任务分发，网络通信，负载均衡和系统维护，不仅无法达到相同性能而且很可能多出来一堆事情。单台机器的问题是购买价格贵。而且整合在一起的话, 一台单一机器由于可以overcommit, 在实践中经常可以整合远超n的s/n能力机器。
   - 关于这个问题, 可以参考LinuxOne的以一当百的理念. 这样的机器唯一缺点是购买价格贵, 价格肯定远超n倍。

2. **到达率和服务率都翻倍时，平均响应时间是否保持不变？**

    GPT说的套话：

    - 理论上，如果所有参数都成比例增加，系统的平均响应时间应该保持不变。然而，实际情况中，由于系统的非线性特性（如队列长度、上下文切换开销等），响应时间可能不会严格保持一致，尤其是在负载接近系统容量时，非线性效应会变得明显。

    我的见解：

    - 吞吐不等于延时，吞吐线性增长了，但是延时还是有可能变长。排队队列就是关键因素之一。
    - 这和本书的答案不一致。

3. **系统是否应该平衡负载？**

    负载平衡通常是优化系统性能的一个目标，特别是在分布式系统中。然而，过度追求平衡可能会引入额外的开销，尤其是如果不同任务的优先级、工作量或执行时间不同。有时不平衡反而更有利，比如根据任务的紧急性或重要性进行调度。

    我的见解：

    关键还是看需求。 比如取决于对缓存的使用，有时把某些特定任务集中在某些节点或者处理器上跑，会更高效率使用缓存，提高处理速度。所以, 才有了按照负载类型分类的处理队列.

4. **调度策略偏向某些任务是否会伤害其他任务？**

    GPT的答案:

    调度策略是系统性能优化中的关键问题。比如，短作业优先（Shortest Job First, SJF）通常可以优化整体响应时间，但可能会导致长作业被饿死。调度的难点就在于如何在公平性和效率之间做出平衡。守恒定律并不能涵盖所有情况下的调度影响，因此“伤害”其他任务的可能性确实存在。

    我的见解:

    要非常小心的去修改调度策略, 非常小心地去做实验, 修改任务的优先级, 经常会导致意想不到的问题出现.

5. **在服务器群中，贪婪的、最短延迟的路由策略有意义吗？还是说对个体有利的策略对整个系统反而是灾难性的？**

    
    GPT的答案:

    在局部看，贪婪的路由策略有利于减少某些任务的延迟，但可能会造成全局负载的不均衡，导致部分服务器过载、其他服务器闲置，从而降低整体性能。好的路由策略应考虑全局最优而非局部最优。

6. **高作业规模变异性和重尾工作负载对调度策略的影响**

    高作业变异性和重尾工作负载会增加调度的不确定性，容易导致系统性能不稳定。典型的 FIFO（先进先出）调度在这种情况下可能会表现不佳，SJF 或者基于优先级的调度可以更好地处理这类情况，但需要注意避免长作业被饿死。

    **高作业规模的变异性**（High Job Size Variability）和**重尾工作负载**（Heavy-tailed Workloads）是两个关键的概念，尤其在设计和评估计算机系统和网络服务的性能时特别重要。

      1. **高作业规模的变异性**：
         - 这个概念描述的是在一个系统中，处理的任务或作业的大小（如所需处理时间、所需内存或CPU资源）之间的变异性很大。这意味着系统必须能够有效处理从非常小到非常大的多种规模的任务。
         - 高变异性可能导致系统性能不稳定，因为大任务可能会阻塞资源，延迟对其他较小任务的响应。

      2. **重尾工作负载**：
         - 重尾分布是一种概率分布，其尾部的衰减速度比指数衰减慢得多，这意味着在尾部出现极端值的概率比正态分布或指数分布要高。
         - 在工作负载上下文中，这表明系统将不定期地遇到一些异常大的请求或任务，这些大任务的处理时间和资源需求远远超过常规任务。这种分布特性对于系统设计者来说是一个挑战，因为他们需要设计系统以便能够高效处理这些极端情况而不会牺牲整体性能。

    在实际应用中，系统和网络设计师必须考虑这些因素来优化系统的响应时间和资源利用率，确保系统即使在面对非常大或复杂的任务时也能保持稳定和效率。这通常涉及到复杂的资源调度策略和优先级规则，以及可能的资源预留策略，以减轻大任务带来的影响。

    在实际应用中, 主机以太网卡采用了基于workload分类的队列, 单独处理大任务和小任务.

7. **能耗与延迟的权衡**

    GPT的答案:
    - 在现代系统中，能耗与性能的权衡非常重要。减少延迟往往需要增加资源消耗（如更多的并行计算、较高的频率等），而节能模式通常意味着较低的计算速度和较长的响应时间。如何在两者之间做出合理的平衡，取决于应用的需求和用户的耐受性。某些系统可以根据负载情况动态调整策略。

    我的见解: 
    - 做这个平衡, 只是眼前的苟且. 新一代的设计可以既要又要还要. 比如软件上选择一个高效的设计, 是可以做到既要又要还要的; 同样的硬件上, 我也见识过先进的压缩加速芯片, 可以做到既减少能耗,又减少空间需求,还减少处理器开销, 还减少演示。用一句行话来说, 这个世界就是个草台班子, 博弈论理想世界里的那些超级聪明人在遇到复杂问题时, 其实也是草台班子。

8. **服务器需求的扩展性问题**

    如果系统的工作负载随着到达率成比例增加，理想情况下，服务器数量也应该成比例增加。但由于某些资源的竞争（如网络带宽、存储 I/O），并不是所有情况下都能达到线性扩展，可能需要比简单的比例关系更多的服务器来满足延迟要求。

[下一篇](/queueing/preface/)